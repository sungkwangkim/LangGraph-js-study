# 잠실 직장인 점심 추천 챗봇 PRD

## 1. 프로젝트 개요

### 1.1 프로젝트 명

잠실 직장인 점심 추천 챗봇 (Streamlit 기반)

### 1.2 목적

잠실 롯데월드타워 근무자를 대상으로 날씨 정보를 고려한 맞춤형 점심 식당 추천 서비스 제공

### 1.3 타겟 사용자

- 주 타겟: 잠실 롯데월드타워 근무 직장인
- 부 타겟: 잠실 지역 직장인 및 방문객

### 1.4 개발 일정

- **MVP 출시 목표**: 2026년 1월 9일 (목요일)
- **개발 방식**: Phase 1, 2로 분리 개발

---

## 2. 핵심 기능 명세

### 2.1 Phase 1 (MVP - 1월 9일까지)

#### 2.1.1 위치 및 날씨 기반 초기 설정

**기능 설명**: 사용자 접속 시 위치와 날씨 정보를 자동으로 수집하고 분석

**세부 구현**:

1. **위치 정보 수집**
   - 브라우저 Geolocation API 사용
   - 사용자 동의 획득 (브라우저 기본 프롬프트 활용)
   - 수집 정보: 위도(latitude), 경도(longitude)

2. **롯데월드타워 근무자 판별**
   - 사용자 위치가 다음 좌표 범위 내에 있는지 확인

   ```
   좌표 1: 37.51322614728272, 127.10032327792408
   좌표 2: 37.51468881588385, 127.10522128987581
   좌표 3: 37.5114549924181, 127.10203923668487
   좌표 4: 37.51321260161727, 127.10590364302612
   ```

   - 판별 알고리즘: Point-in-Polygon 체크

3. **날씨 정보 수집**
   - API: 한국 기상청 API
   - 수집 정보:
     - 기온 (°C)
     - 강수량 (mm)
     - 적설량 (cm)
     - 미세먼지 (PM2.5)
     - 풍속 (m/s)
     - 하늘 상태 (구름 비율)

4. **날씨 정보 표시**
   - 사용자에게 간단한 날씨 요약 제공
   - 표시 항목: 온도, 비/눈 여부, 더위/추위 정도, 미세먼지, 바람

#### 2.1.2 외출 난이도 판단 및 실내 식당 자동 추천

**기능 설명**: 악천후 시 롯데월드타워 근무자에게 실내 식당 자동 추천

**조건 (AND 조건)**:

- 롯데월드타워 근무자 여부: TRUE
- 외출하기 힘든 상황: 다음 중 하나 이상 해당
  - 강수량 ≥ 5mm
  - 적설량 ≥ 5cm
  - 기온 ≥ 33°C (폭염)
  - 기온 ≤ -8°C (한파)
  - 미세먼지 PM2.5 ≥ 75 (매우 나쁨)
  - 풍속 ≥ 9 m/s (강풍)

**추천 대상**:

- 롯데월드몰 내 음식점
- 롯데백화점 푸드코트

**데이터 소스**:

- 로컬 MySQL DB
- 테이블: `restaurants`
- 필터 조건: `location_type IN ('롯데월드몰', '롯데백화점')`

**표시 형식**:

- 자동 추천 메시지 + 식당 3개 표시
- 식당 정보:
  - 가게명 (`name`)
  - 대표메뉴 (`signature_menu`)
  - 썸네일 이미지 (`main_thumbnail_url`)
  - 네이버 리뷰수 (`naver_review_count`)
  - 간단한 지도 표시 (위도/경도 기반)

#### 2.1.3 날씨 기반 메뉴 검색어 추천

**기능 설명**: 외출 가능한 날씨일 때 날씨에 적합한 메뉴 검색어를 버튼으로 제공

**날씨 조건별 추천 로직**:

1. **더운 날** (기온 ≥ 28°C, 하늘 맑음/구름 적음):
   - 추천: "냉면", "샐러드", "물냉면", "콩국수", "시원한 국수"

2. **추운 날** (기온 ≤ 5°C):
   - 추천: "국밥", "찌개", "뚝배기", "전골", "따뜻한 국물"

3. **비 오는 날** (강수량 1~4mm):
   - 추천: "파전", "부침개", "칼국수", "수제비", "찌개"

4. **흐린 날** (구름 9~10할):
   - 추천: "얼큰한 국물", "찌개", "매운 음식", "김치찌개"

5. **맑은 날** (구름 0~5할):
   - 추천: "샐러드", "덮밥", "파스타", "일식", "가벼운 식사"

**UI 구성**:

- 버튼 리스트 형태로 5개 검색어 제공
- 추가 옵션: 텍스트 입력 필드 (원하는 검색어가 없을 때)

#### 2.1.4 ChromaDB 기반 식당 검색

**기능 설명**: 사용자가 선택하거나 입력한 검색어로 ChromaDB에서 유사도 검색

**데이터 준비**:

1. MySQL → ChromaDB 동기화
2. 각 식당을 Markdown 형식으로 변환하여 저장

   ```markdown
   # [가게명]

   - 카테고리: [category]
   - 대표메뉴: [signature_menu]
   - 메뉴: [menus 테이블에서 조인]
   - 설명: [description]
   - 위치: [location_type]
   - 날씨 태그: [weather_tags 테이블에서 조인]
   ```

**검색 프로세스**:

1. 사용자 검색어 입력
2. ChromaDB에서 벡터 유사도 기반 검색
3. Top 3 결과 반환

**결과 표시**:

- 식당 카드 3개
- 각 카드에 포함될 정보:
  - 가게명
  - 썸네일 이미지 (main_thumbnail_url)
  - 대표메뉴
  - 대표 가격 (menus 테이블에서 가장 대표적인 메뉴 1개)
  - 네이버 리뷰수
  - 지도 (위도/경도로 간단한 지도 표시)
  - "먹었어요" 버튼

#### 2.1.5 "먹었어요" 기록

**기능 설명**: 사용자가 추천받은 식당 중 실제로 방문한 곳을 기록

**구현 방식**:

- 각 식당 카드에 "먹었어요" 버튼 추가
- 버튼 클릭 시:
  - Streamlit session_state에 임시 저장
  - 화면에 "기록되었습니다" 메시지 표시
- **Phase 2에서 DB 저장 기능 추가 예정**

---

### 2.2 Phase 2 (추후 개발)

#### 2.2.1 사용자 기록 영구 저장

- 로그인 기능 추가 (선택 사항)
- 사용자별 식사 기록 DB 저장
- 기록 기반 맞춤 추천

#### 2.2.2 고급 추천 알고리즘

- 사용자 선호도 학습
- 최근 먹은 메뉴 제외 필터
- 협업 필터링 기반 추천

#### 2.2.3 추가 기능

- 식당 상세 정보 페이지
- 리뷰 통합 표시
- 즐겨찾기 기능
- 공유 기능

---

## 3. 기술 스택

### 3.1 Frontend

- **Framework**: Streamlit
- **지도 라이브러리**: Folium 또는 Streamlit-Foliu
- **이미지 표시**: Streamlit Image

### 3.2 Backend

- **언어**: Python 3.13+
- **웹 프레임워크**: Streamlit
- **데이터베이스**: MySQL (로컬)
- **벡터 DB**: ChromaDB
- **임베딩 모델**: OpenAI Embeddings 또는 sentence-transformers

### 3.3 API

- **날씨**: 한국 기상청 API
- **위치**: 브라우저 Geolocation API

### 3.4 데이터 구조

#### MySQL 테이블:

1. `restaurants`: 음식점 기본 정보
2. `menus`: 메뉴 정보
3. `weather_tags`: 날씨 태그 마스터
4. `restaurant_weather_tags`: 음식점-날씨 태그 매핑
5. `restaurant_thumbnails`: 썸네일 이미지

---

## 4. 주요 화면 플로우

### 4.1 초기 화면

```
[앱 시작]
    ↓
[위치 정보 요청 & 날씨 API 호출]
    ↓
[날씨 정보 간단 표시]
    ↓
[조건 판단]
    ├─ 롯데타워 근무자 + 악천후 → [실내 식당 자동 추천 3개]
    └─ 그 외 → [날씨 기반 검색어 버튼 5개 + 텍스트 입력]
```

### 4.2 검색 및 결과

```
[검색어 선택 또는 입력]
    ↓
[ChromaDB 검색]
    ↓
[식당 카드 3개 표시]
    ├─ 썸네일 이미지
    ├─ 가게명, 대표메뉴, 가격
    ├─ 네이버 리뷰수
    ├─ 지도
    └─ "먹었어요" 버튼
    ↓
["먹었어요" 클릭 시 기록]
```

---

## 5. 데이터 요구사항

### 5.1 날씨 태그 예시 데이터

`weather_tags` 테이블에 미리 입력할 태그:

- 더운날
- 추운날
- 비오는날
- 맑은날
- 흐린날
- 실내식당
- 외부식당

### 5.2 ChromaDB 컬렉션 구조

- **컬렉션명**: `jamsil_restaurants`
- **Document**: 식당별 Markdown 텍스트
- **Metadata**:
  - restaurant_id
  - name
  - category
  - location_type
  - latitude
  - longitude
  - main_thumbnail_url
  - naver_review_count

---

## 6. 성능 요구사항

### 6.1 응답 시간

- 위치 및 날씨 정보 로딩: 3초 이내
- ChromaDB 검색 결과: 2초 이내
- 지도 렌더링: 1초 이내

### 6.2 동시 사용자

- MVP 기준: 10명 동시 접속 지원

---

## 7. 제약사항 및 가정

### 7.1 제약사항

- 비로그인 상태로 운영 (Phase 1)
- 사용자 기록은 세션 기반 임시 저장
- 브라우저 위치 정보 제공 동의 필수

### 7.2 가정

- 사용자는 롯데월드타워 또는 잠실 인근에서 접속
- MySQL DB에 최소 50개 이상의 식당 데이터 존재
- 한국 기상청 API 무료 플랜 사용 (1,000 calls/day)

---

## 8. 위험 요소 및 대응 방안

### 8.1 위험 요소

1. **위치 정보 거부**: 사용자가 위치 제공을 거부할 경우
   - 대응: 수동으로 위치 선택 기능 제공 (예: "롯데월드타워", "잠실역" 등)

2. **날씨 API 장애**: 한국 기상청 API 호출 실패
   - 대응: 기본 날씨 상태로 진행 (맑음으로 가정)

3. **ChromaDB 검색 결과 없음**: 검색어에 맞는 식당이 없을 경우
   - 대응: "검색 결과가 없습니다. 다른 검색어를 시도해보세요" 메시지 + 전체 카테고리 버튼 제공

### 8.2 향후 개선 사항

- 사용자 피드백 수집 (만족도 평가)
- A/B 테스트 (추천 알고리즘 개선)
- 모바일 최적화

---

## 9. 개발 우선순위

### Phase 1 (1월 5일 ~ 1월 9일)

1. **Day 1 (1/5)**:
   - 위치 정보 수집 및 롯데타워 판별 로직
   - 날씨 API 연동
   - MySQL 연결 및 데이터 확인

2. **Day 2 (1/6)**:
   - MySQL → ChromaDB 동기화 스크립트
   - 날씨 조건별 검색어 추천 로직
   - 외출 난이도 판단 및 실내 식당 자동 추천

3. **Day 3 (1/7)**:
   - ChromaDB 검색 기능
   - 식당 카드 UI 구현
   - 지도 연동

4. **Day 4 (1/8)**:
   - "먹었어요" 기능 구현
   - 전체 플로우 테스트
   - 버그 수정

5. **Day 5 (1/9)**:
   - 최종 테스트
   - UI/UX 개선
   - MVP 배포

---

## 10. 성공 지표 (Phase 1)

### 10.1 기술적 지표

- [ ] 위치 정보 수집 성공률 > 90%
- [ ] 날씨 API 호출 성공률 > 95%
- [ ] ChromaDB 검색 응답 시간 < 2초
- [ ] 앱 크래시 없음

### 10.2 사용자 경험 지표

- [ ] 사용자가 3번의 클릭 내에 식당 추천 결과 확인 가능
- [ ] "먹었어요" 기능 정상 작동
- [ ] 실내 식당 자동 추천 조건 정확도 100%

---

## 11. 부록

### 11.1 참고 자료

- 한국 기상청 API 문서: [https://www.weather.go.kr](https://www.weather.go.kr/w/wnuri-fct2021/ext/current-weather.do)
- Streamlit 문서: https://docs.streamlit.io
- ChromaDB 문서: https://docs.trychroma.com

### 11.2 용어 정의

- **MVP**: Minimum Viable Product (최소 기능 제품)
- **ChromaDB**: 벡터 기반 유사도 검색을 위한 임베딩 데이터베이스
- **Point-in-Polygon**: 점이 다각형 내부에 있는지 판별하는 알고리즘

### 11.3 담당자 정보

- 프로젝트 리드: [이름]
- 개발자: [이름]
- 데이터 담당: [이름]
- 배포 목표일: 2026년 1월 9일 (목)

---

**문서 버전**: 1.0  
**최종 수정일**: 2026년 1월 5일  
**다음 검토일**: 2026년 1월 9일 (MVP 완료 후)
